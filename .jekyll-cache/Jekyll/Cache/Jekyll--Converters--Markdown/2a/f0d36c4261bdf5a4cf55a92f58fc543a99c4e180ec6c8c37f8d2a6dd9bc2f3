I"ºÍ<h1 id="table-of-contents">Table of Contents</h1>

<!-- MarkdownTOC autolink="true" levels="1,2" -->

<ul>
  <li><a href="#1-introduction-functional-enrichment">1. Introduction: functional enrichment</a>
    <ul>
      <li><a href="#11-the-gene-ontology-go-resource">1.1 The Gene Ontology (GO) resource</a></li>
      <li><a href="#12-the-kyoto-encyclopedia-of-genes-and-genomes-kegg-database">1.2 The Kyoto Encyclopedia of Genes and Genomes (KEGG) database</a></li>
      <li><a href="#13-introduction">1.3 Introduction</a></li>
    </ul>
  </li>
  <li><a href="#2-annotating-your-de-genes">2. Annotating your DE genes</a>
    <ul>
      <li><a href="#21-load-the-table-of-differential-genes">2.1 Load the table of differential genes</a></li>
      <li><a href="#22-ensembl-databases">2.2 Ensembl databases</a></li>
      <li><a href="#23-querying-ensembl-databases-using-biomartr">2.3 Querying Ensembl databases using biomartr</a></li>
    </ul>
  </li>
  <li><a href="#3-over-representation-analysis-with-clusterprofiler-r-code">3. Over Representation Analysis with ClusterProfiler (R code)</a>
    <ul>
      <li><a href="#31-gene-ontology-ora">3.1 Gene Ontology ORA</a></li>
      <li><a href="#32-gene-ontology-plots">3.2 Gene ontology plots</a></li>
      <li><a href="#33-kegg-ora">3.3 KEGG ORA</a></li>
      <li><a href="#34-kegg-modules-ora">3.4 KEGG Modules ORA</a></li>
    </ul>
  </li>
  <li><a href="#4gene-ontology-over-representation-analysis-with-agrigo-webtool">4.Gene Ontology Over Representation Analysis with AgriGO (webtool)</a>
    <ul>
      <li><a href="#41-single-enrichment-analysis">4.1 Single Enrichment Analysis</a></li>
      <li><a href="#42-parametric-analysis-of-gene-set-enrichment">4.2 Parametric Analysis of Gene Set Enrichment</a></li>
      <li><a href="#33-metascape-webtool">3.3 Metascape (webtool)</a></li>
      <li><a href="#34-gene-set-enrichment-analysis-gsea">3.4 Gene Set Enrichment Analysis (GSEA)</a></li>
    </ul>
  </li>
  <li><a href="#5-gene-set-enrichment-analysis-gsea-with-clusterprofiler">5. Gene Set Enrichment Analysis (GSEA) with ClusterProfiler</a></li>
  <li><a href="#6-troubleshooting">6. Troubleshooting</a></li>
  <li><a href="#7-going-further">7. Going further</a>
    <ul>
      <li><a href="#61-useful-links">6.1 Useful links</a></li>
      <li><a href="#62-references">6.2. References</a></li>
    </ul>
  </li>
</ul>

<!-- /MarkdownTOC -->

<p><img src="../img/07-workflow-overview.png" width="500px" alt="workflow overview" /></p>

<h1 id="1-introduction-functional-enrichment">1. Introduction: functional enrichment</h1>

<p>You‚Äôve finally managed to extract a list of differentially expressed genes from your comparison. Great job! 
But‚Ä¶now what? :question: :confused:</p>

<p>Why did you do the experiment in the first place? Probably because you had an hypothesis or you were looking to open new leads.</p>

<p>A functional enrichement analysis will determine whether some functions are enriched in your set of differentially expressed genes.</p>

<p>In this tutorial, we are looking for Arabidopsis leaf genes that are induced or repressed upon inoculation by <em>Pseudomonas syringae</em> DC3000 after 7 days.
One important goal is to gain a higher view and not only deal with individual genes but understand which pathways are involved in the response.</p>

<p>Once we obtain a list of genes, we have multiple analysis to perform to go beyond a simple list of genes:</p>
<ul>
  <li>Annotating our list of genes with cross-databases identifiers and descriptions (Entrezid, Uniprot, KEGG, etc.).</li>
  <li>Performing Over-Representation Analysis (ORA) and Gene Set Enrichment Analysis (GSEA) using R or webtools.</li>
  <li>Interpreting the results.</li>
</ul>

<p>These ORA and GSEA analysis require the use of external resources to assign functions to genes. Two resources are of particular importance and will be examined in this tutorial.</p>

<h2 id="11-the-gene-ontology-go-resource">1.1 The Gene Ontology (GO) resource</h2>

<p>The <strong>Gene Ontology (GO)</strong> produces a bird‚Äôs-eye view of biological systems by building a tree of terms related to biological functions. 
This is particularly helpful when dealing with results from genome-wide experiments (e.g. transcriptomics) since classifying genes into groups of related functions can assist in the interpretation of results. Rather than focusing on each gene, one by one, the researcher gets access to metabolic pathways, functions related to development, etc.</p>

<blockquote class="callout">
  <h2 id="note">Note</h2>
  <p>One could more also define the Gene Ontology as a series of relations between controlled vocabulary terms.</p>
</blockquote>

<p>The GO resource is divided into 3 main subdomains:</p>
<ol>
  <li><strong>Biological Process (BP)</strong>: a series of molecular events with a defined beginning and end relevant for the function of an organism, a cell, etc.</li>
  <li><strong>Cellular Component (CC)</strong>: the part of a cell.</li>
  <li><strong>Molecular Function (MF)</strong>: the enzymatic activites of a gene product.</li>
</ol>

<p><a href="https://en.wikipedia.org/wiki/Gene_ontology">Source Wikipedia</a>.</p>

<p>Let‚Äôs take an example. The At3g53260 gene codes for a phenylalanine ammonia-lyase (PAL) that catalyses the following reaction and is one of the first step of cell wall synthesis, flavonoid synthesis, etc. ; L-phenylalanine ‚áå trans-cinnamic acid + <script type="math/tex">NH_{3}</script></p>

<p>This gene has several GO terms associated:</p>

<p><img src="../img/07-tair_pal_gene_ontology.png" height="600px" alt="AT3G53260 page on arabidopsis.org" /></p>

<p>Here are an example term associated with each GO subdomain:</p>
<ol>
  <li><strong>BP:</strong> the ‚ÄúL-phenylalanine catabolic process‚Äù term with the GO:0006559 unique identifier.</li>
  <li><strong>CC</strong>: the ‚Äúcytoplasm‚Äù term with the GO:0005737 unique identifier.</li>
  <li><strong>MF</strong>: the ‚Äúammonia-lyase activity‚Äù term with the GO:0016841 unique identifier.</li>
</ol>

<blockquote class="challenge">
  <h2 id="exercise">Exercise</h2>
  <p>Go to the <a href="http://amigo.geneontology.org/amigo/landing">AmiGO 2 website</a> and enter the term ‚ÄúGO:0006559‚Äù (L-phenylalanine catabolic process).</p>
  <ol>
    <li>Can you find the number of genes in <strong>ALL</strong> organisms that are associated with this term?</li>
    <li>Can you find the number of genes <strong>ONLY</strong> in <em>Arabidopsis thaliana</em> associated with this term?</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>
    <ol>
      <li>There are <strong>712</strong> genes in all organisms associated with this term (AmiGO 2 version 2.5.13). Hint: Using the free text filter field and ‚Äúarabidopsis thaliana pal1‚Äù, you rapidly find that PAL1 has the AT2G37040 gene identifier.</li>
      <li>There are <strong>12</strong> genes associated with this term in <em>Arabidopsis thaliana</em>.  By clicking on ‚ÄúOrganism‚Äù and filtering to keep only ‚ÄúViridiplantae‚Äù species, one can see 12 genes next to Arabidopsis.</li>
    </ol>
  </blockquote>
</blockquote>

<h2 id="12-the-kyoto-encyclopedia-of-genes-and-genomes-kegg-database">1.2 The Kyoto Encyclopedia of Genes and Genomes (KEGG) database</h2>

<p>KEGG stands for the ‚ÄúKyoto Encyclopedia of Genes and Genomes‚Äù. From the <a href="https://www.genome.jp/kegg/">KEGG website home page</a>:</p>
<blockquote>
  <p>KEGG is a database resource for understanding high-level functions and utilities of the biological system, such as the cell, the organism and the ecosystem, from molecular-level information, especially large-scale molecular datasets generated by genome sequencing and other high-throughput experimental technologies.</p>
</blockquote>

<p>Instead of using the Gene Ontology gene classification, one might be interested to use KEGG classification to view the
transcriptomic response of an organism. KEGG is not restricted to metabolic functions but has a great deal of metabolic maps that can help you.</p>

<blockquote class="callout">
  <h2 id="important-note">Important note</h2>
  <p>While using a model organism such as <em>Arabidopsis thaliana</em> makes ORA and GSEA analyses easier, it is noteworthy that the GO and KEGG resources are not restricted to model organisms but rather include a huge number of (plant) species.</p>
</blockquote>

<h2 id="13-introduction">1.3 Introduction</h2>

<p>Over Representation Analysis is searching for biological functions or pathways that are enriched in a list obtained through experimental studies compared to the complete list of functions/pathways.</p>

<p>Usually, ORA makes use of so-called gene ontologies (abbreviated GO) where each gene receives one or multiple layers of information on their function, cellular localization, etc.</p>

<p>The ORA analysis rely on this mathematical equation to compute a p-value for a given gene set classified under a certain GO.</p>

<script type="math/tex; mode=display">p = 1 - {\sum_{i=0}^{k-1} {M \choose i}{N - M \choose n - i} \over {N \choose n}}</script>

<p>In this formula:</p>
<ul>
  <li><strong>N</strong> is the total number of genes in the background distribution. Also called the ‚Äúuniverse‚Äù of our transcriptome.</li>
  <li><strong>M</strong> is the number of genes within that distribution that are annotated (either directly or indirectly) to the gene set of interest.</li>
  <li><strong>n</strong> is the size of the list of genes of interest (the size of your ‚Äúdrawing‚Äù).</li>
  <li><strong>k</strong> and k is the number of genes within that list which are annotated to the gene set.</li>
</ul>

<p>The background distribution by default is by default all genes that have annotation. You can change it to your specific background if you have a good reason for that (only genes with a detectable expression in your expression for instance). Also, p-values should be adjusted for multiple comparison.</p>

<p>Do you remember your math classes from high school? Now‚Äôs the time to get them to work again!</p>

<p>Binomial coefficient is defined as <script type="math/tex">{n \choose k}</script> and is equal to <script type="math/tex">n! \over {k! (n-k)!}</script></p>

<p>‚Äî‚Äî‚Äî drawing of balls from an urn ‚Äî‚Äî</p>

<p>See this <a href="https://yulab-smu.github.io/clusterProfiler-book/chapter2.html">great chapter</a> from Prof. Guangchuang Yu (School of Basic Medical Sciences, Southern Medical University, China) for more info.</p>

<h1 id="2-annotating-your-de-genes">2. Annotating your DE genes</h1>

<p>We are going to use two fantastic resources: the superb <a href="https://www.ensembl.org">Ensembl</a> databases and the marvelous <a href="https://docs.ropensci.org/biomartr">biomartr package</a>.
Together, they will automate a lot of tedious and tiring steps when you want to retrieve gene annotations, sequences, etc.</p>

<p>We are going to load the required library first.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"biomartr"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"clusterProfiler"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"tidyverse"</span><span class="p">)</span><span class="w">
</span><span class="n">suppressPackageStartupMessages</span><span class="p">(</span><span class="n">library</span><span class="p">(</span><span class="s2">"org.At.tair.db"</span><span class="p">))</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"biomaRt"</span><span class="p">)</span><span class="w">  </span><span class="c1"># only use to remove cache bug</span><span class="w">
</span></code></pre></div></div>

<h2 id="21-load-the-table-of-differential-genes">2.1 Load the table of differential genes</h2>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">diff_genes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_delim</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"differential_genes.tsv"</span><span class="p">,</span><span class="w"> </span><span class="n">delim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\t"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>All what we know about the differential genes are their locus identifier. Not much‚Ä¶.
We are missing functional information which we will add.</p>

<h2 id="22-ensembl-databases">2.2 Ensembl databases</h2>
<p>Gene information can be automatically queried directly from R to access the <a href="https://www.ensembl.org">Ensembl</a> databases. 
Ensembl gathers a tremendous amount of genomic information which can be accessed through a web browser or programmatically.</p>

<blockquote>
  <p>The Ensembl (https://www.ensembl.org) is a system for generating and distributing genome annotation such as genes, variation, regulation and comparative genomics across the vertebrate subphylum and key model organisms. The Ensembl annotation pipeline is capable of integrating experimental and reference data from multiple providers into a single integrated resource. Here, we present 94 newly annotated and re-annotated genomes, bringing the total number of genomes offered by Ensembl to 227.</p>
</blockquote>

<p><img src="../img/07-ensembl.png" alt="Portal of Ensembl for Arabidopsis" width="1000px" /></p>

<h2 id="23-querying-ensembl-databases-using-biomartr">2.3 Querying Ensembl databases using biomartr</h2>

<p>What purpose serves <code class="highlighter-rouge">biomartr</code>? From the documentation:</p>
<blockquote>
  <p>The first step, however, of any genome based study is to retrieve genomes and their annotation from databases. To automate the retrieval process of this information on a meta-genomic scale, the biomartr package provides interface functions for genomic sequence retrieval and functional annotation retrieval. The major aim of biomartr is to facilitate computational reproducibility and large-scale handling of genomic data for (meta-)genomic analyses. In addition, biomartr aims to address the genome version crisis. With biomartr users can now control and be informed about the genome versions they retrieve automatically. Many large scale genomics studies lack this information and thus, reproducibility and data interpretation become nearly impossible when documentation of genome version information gets neglected.</p>
</blockquote>

<p>What is available for <em>Arabidopsis thaliana</em> in Ensembl?</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># library("biomartr") (if not loaded already)</span><span class="w">
</span><span class="n">biomartr</span><span class="o">::</span><span class="n">organismBM</span><span class="p">(</span><span class="n">organism</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Arabidopsis thaliana"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>organism_name description                                                  mart         dataset       version
  &lt;chr&gt;         &lt;chr&gt;                                                        &lt;chr&gt;        &lt;chr&gt;         &lt;chr&gt;  
1 athaliana     Arabidopsis thaliana genes (TAIR10)                          plants_mart  athaliana_eg‚Ä¶ TAIR10 
2 athaliana     Arabidopsis thaliana Short Variants (SNPs and indels exclud‚Ä¶ plants_vari‚Ä¶ athaliana_eg‚Ä¶ TAIR10 
</code></pre></div></div>

<p>This indicates that we can get a dataset called <code class="highlighter-rouge">athaliana_eg_gene</code> of the genome annotation version <code class="highlighter-rouge">TAIR10</code> from the <code class="highlighter-rouge">plant_mart</code> mart.</p>

<p>Let‚Äôs see how many different information fields we can retrieve from the <code class="highlighter-rouge">arabidopsis_eg_gene</code> dataset.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">arabido_attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> 
  </span><span class="n">biomartr</span><span class="o">::</span><span class="n">organismAttributes</span><span class="p">(</span><span class="s2">"Arabidopsis thaliana"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">dataset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"athaliana_eg_gene"</span><span class="p">)</span><span class="w">
</span><span class="n">arabido_attributes</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 2,574 x 4
   name                  description              dataset           mart       
   &lt;chr&gt;                 &lt;chr&gt;                    &lt;chr&gt;             &lt;chr&gt;      
 1 ensembl_gene_id       Gene stable ID           athaliana_eg_gene plants_mart
 2 ensembl_transcript_id Transcript stable ID     athaliana_eg_gene plants_mart
 3 ensembl_peptide_id    Protein stable ID        athaliana_eg_gene plants_mart
 4 ensembl_exon_id       Exon stable ID           athaliana_eg_gene plants_mart
 5 description           Gene description         athaliana_eg_gene plants_mart
 6 chromosome_name       Chromosome/scaffold name athaliana_eg_gene plants_mart
 7 start_position        Gene start (bp)          athaliana_eg_gene plants_mart
 8 end_position          Gene end (bp)            athaliana_eg_gene plants_mart
 9 strand                Strand                   athaliana_eg_gene plants_mart
10 band                  Karyotype band           athaliana_eg_gene plants_mart
# ‚Ä¶ with 2,564 more rows
</code></pre></div></div>

<p>:scream: There is quite some information in there! We should be able to get what we want!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">attributes_to_retrieve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"tair_symbol"</span><span class="p">,</span><span class="w"> </span><span class="s2">"entrezgene_id"</span><span class="p">)</span><span class="w">

</span><span class="n">result_BM</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">biomartr</span><span class="o">::</span><span class="n">biomart</span><span class="p">(</span><span class="w"> </span><span class="n">genes</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">diff_genes</span><span class="o">$</span><span class="n">genes</span><span class="p">,</span><span class="w">                  </span><span class="c1"># genes were retrieved using biomartr::getGenome()</span><span class="w">
                                </span><span class="n">mart</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"plants_mart"</span><span class="p">,</span><span class="w">                     </span><span class="c1"># marts were selected with biomartr::getMarts()</span><span class="w">
                                </span><span class="n">dataset</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"athaliana_eg_gene"</span><span class="p">,</span><span class="w">               </span><span class="c1"># datasets were selected with biomartr::getDatasets()</span><span class="w">
                                </span><span class="n">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attributes_to_retrieve</span><span class="p">,</span><span class="w">            </span><span class="c1"># attributes were selected with biomartr::getAttributes()</span><span class="w">
                                </span><span class="n">filters</span><span class="w"> </span><span class="o">=</span><span class="w"> 	</span><span class="s2">"ensembl_gene_id"</span><span class="w"> </span><span class="p">)</span><span class="c1"># query key</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">result_BM</span><span class="p">)</span><span class="w">  
</span></code></pre></div></div>

<p>We now have our original gene identifiers (column <code class="highlighter-rouge">ensembl_gene_id</code>) with the retrieved TAIR symbols (<code class="highlighter-rouge">tair_symbol</code>) and NCBI Entrez Gene Id (<code class="highlighter-rouge">entrezgene_id</code>).</p>
<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ensembl_gene_id  tair_symbol entrezgene_id
1       AT1G01030         NGA3        839321
2       AT1G01070                     839550
3       AT1G01090 PDH-E1 ALPHA        839429
4       AT1G01140        CIPK9        839349
5       AT1G01220         FKGP        839420
6       AT1G01225                     839358
</code></pre></div></div>

<p><br /></p>

<h1 id="3-over-representation-analysis-with-clusterprofiler-r-code">3. Over Representation Analysis with ClusterProfiler (R code)</h1>

<h2 id="31-gene-ontology-ora">3.1 Gene Ontology ORA</h2>

<p>To perform the ORA within R, we will use the <a href="https://bioconductor.org/packages/release/bioc/html/clusterProfiler.html">clusterProfiler Bioconductor package</a> that has an <a href="https://yulab-smu.github.io/clusterProfiler-book/index.html">extensive documentation available here</a>.</p>

<h3 id="311-enrichment-analysis">3.1.1 Enrichment analysis</h3>
<p>First, we need to annotate both genes that make up our ‚Äúuniverse‚Äù and the genes that were identified as differentially expressed.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># building the universe!</span><span class="w">
</span><span class="n">all_arabidopsis_genes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"counts.txt"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># directly selects the gene column</span><span class="w">

</span><span class="c1"># we want the correspondence of TAIR/Ensembl symbols with NCBI Entrez gene ids</span><span class="w">
</span><span class="n">attributes_to_retrieve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"tair_symbol"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uniprotswissprot"</span><span class="p">,</span><span class="s2">"entrezgene_id"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Query the Ensembl API</span><span class="w">
</span><span class="n">all_arabidopsis_genes_annotated</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">biomartr</span><span class="o">::</span><span class="n">biomart</span><span class="p">(</span><span class="n">genes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_arabidopsis_genes</span><span class="p">,</span><span class="w">
                                                     </span><span class="n">mart</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"plants_mart"</span><span class="p">,</span><span class="w">                 
                                                     </span><span class="n">dataset</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"athaliana_eg_gene"</span><span class="p">,</span><span class="w">           
                                                     </span><span class="n">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attributes_to_retrieve</span><span class="p">,</span><span class="w">        
                                                     </span><span class="n">filters</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s2">"ensembl_gene_id"</span><span class="w"> </span><span class="p">)</span><span class="w">  

</span><span class="c1"># for compatibility with enrichGO universe</span><span class="w">
</span><span class="c1"># genes in the universe need to be characters and not integers (Entrez gene id)</span><span class="w">
</span><span class="n">all_arabidopsis_genes_annotated</span><span class="o">$</span><span class="n">entrezgene_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="w">
  </span><span class="n">all_arabidopsis_genes_annotated</span><span class="o">$</span><span class="n">entrezgene_id</span><span class="p">)</span><span class="w"> 

</span></code></pre></div></div>

<p>We now have a correspondence for all our genes found in Arabidopsis.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># retrieving NCBI Entrez gene id for our genes called differential</span><span class="w">
</span><span class="n">diff_arabidopsis_genes_annotated</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">biomartr</span><span class="o">::</span><span class="n">biomart</span><span class="p">(</span><span class="n">genes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff_genes</span><span class="o">$</span><span class="n">genes</span><span class="p">,</span><span class="w">
                                                     </span><span class="n">mart</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"plants_mart"</span><span class="p">,</span><span class="w">                 
                                                     </span><span class="n">dataset</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"athaliana_eg_gene"</span><span class="p">,</span><span class="w">           
                                                     </span><span class="n">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attributes_to_retrieve</span><span class="p">,</span><span class="w">        
                                                     </span><span class="n">filters</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s2">"ensembl_gene_id"</span><span class="w"> </span><span class="p">)</span><span class="w">  
</span></code></pre></div></div>

<p>This gave us the second part which is the classification of genes ‚Äúdrawn‚Äù from the whole gene universe. The ‚Äúdrawing‚Äù is coming from the set of genes identified as differential (see <a href="../06-differential-analysis/index.html">episode 06</a>).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># performing the ORA for Gene Ontology Biological Process class</span><span class="w">
</span><span class="n">ora_analysis_bp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">enrichGO</span><span class="p">(</span><span class="n">gene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff_arabidopsis_genes_annotated</span><span class="o">$</span><span class="n">entrezgene_id</span><span class="p">,</span><span class="w"> 
                            </span><span class="n">universe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_arabidopsis_genes_annotated</span><span class="o">$</span><span class="n">entrezgene_id</span><span class="p">,</span><span class="w"> 
                            </span><span class="n">OrgDb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">org.At.tair.db</span><span class="p">,</span><span class="w">  </span><span class="c1"># contains the TAIR/Ensembl id to GO correspondence for A. thaliana</span><span class="w">
                            </span><span class="n">keyType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ENTREZID"</span><span class="p">,</span><span class="w">
                            </span><span class="n">ont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BP"</span><span class="p">,</span><span class="w">              </span><span class="c1"># either "BP", "CC" or "MF",</span><span class="w">
                            </span><span class="n">pAdjustMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BH"</span><span class="p">,</span><span class="w">
                            </span><span class="n">qvalueCutoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w">
                            </span><span class="n">readable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
                            </span><span class="n">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Since we have 3 classes for GO terms i.e. Molecular Function (MF), Cellular Component (CC) and Biological Processes (BP), we have to run this 3 times for each GO class.</p>

<blockquote class="challenge">
  <h2 id="exercise-1">Exercise</h2>
  <p>How many GO categories do you find overrepresented (padj &lt; 0.05) for the Cellular Component and Molecular Function classes?</p>
</blockquote>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ora_analysis_all_go</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">enrichGO</span><span class="p">(</span><span class="n">gene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff_arabidopsis_genes_annotated</span><span class="o">$</span><span class="n">entrezgene_id</span><span class="p">,</span><span class="w"> 
                                </span><span class="n">universe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_arabidopsis_genes_annotated</span><span class="o">$</span><span class="n">entrezgene_id</span><span class="p">,</span><span class="w"> 
                                </span><span class="n">OrgDb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">org.At.tair.db</span><span class="p">,</span><span class="w">
                                </span><span class="n">keyType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ENTREZID"</span><span class="p">,</span><span class="w">
                                </span><span class="n">ont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ALL"</span><span class="p">,</span><span class="w">             
                                </span><span class="n">pAdjustMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BH"</span><span class="p">,</span><span class="w">
                                </span><span class="n">qvalueCutoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w">
                                </span><span class="n">readable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
                                </span><span class="n">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The Gene Ontology classification is very redundant meaning that parental terms overlap a lot with their related child terms. The <code class="highlighter-rouge">clusterProfiler</code> package comes with a dedicated function called <code class="highlighter-rouge">simplify</code> to solve this issue.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># clusterProfiler::simplify to disambiguate which simplify() function you want to use</span><span class="w">
</span><span class="n">ora_analysis_all_go_simplified</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">clusterProfiler</span><span class="o">::</span><span class="n">simplify</span><span class="p">(</span><span class="n">ora_analysis_bp</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">ora_analysis_all_go_simplified</code> is a rich and complex R object. It contains various layers of information (R object from the S4 class). Layers can be accessed through the ‚Äú@‚Äù notation.</p>

<p>You can extract a nice table of results for your next breakthrough publication like this.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write_delim</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">ora_analysis_all_go_simplified</span><span class="o">@</span><span class="n">result</span><span class="p">),</span><span class="w"> 
            </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"go_results.tsv"</span><span class="p">,</span><span class="w"> 
            </span><span class="n">delim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\t"</span><span class="p">)</span><span class="w">

</span><span class="c1"># have a look at a few columns and rows if you'd like.</span><span class="w">
</span><span class="n">ora_analysis_all_go</span><span class="o">@</span><span class="n">result</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="o">:</span><span class="m">8</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           ONTOLOGY         ID                         Description GeneRatio   BgRatio       pvalue     p.adjust       qvalue   
GO:0009753       BP GO:0009753           response to jasmonic acid  257/3829 474/20450 1.099409e-68 1.772247e-65 1.160744e-65   
GO:0009611       BP GO:0009611                response to wounding  187/3829 335/20450 1.252868e-52 1.009812e-49 6.613824e-50
GO:0006612       BP GO:0006612       protein targeting to membrane  199/3829 374/20450 1.683735e-51 4.690438e-49 3.072032e-49
GO:0010243       BP GO:0010243 response to organonitrogen compound  222/3829 443/20450 1.707866e-51 4.690438e-49 3.072032e-49
GO:0072657       BP GO:0072657    protein localization to membrane  200/3829 377/20450 1.745821e-51 4.690438e-49 3.072032e-49
</code></pre></div></div>

<h2 id="32-gene-ontology-plots">3.2 Gene ontology plots</h2>
<p>Nice to have all this textual information but an image is worth a thousand words so let‚Äôs create some visual representations.</p>

<p>A dotplot can be created very easily.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dotplot</span><span class="p">(</span><span class="n">ora_analysis_all_go</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../img/07-dotplot.png" width="800px" /></p>

<p>You can also create an enrichment map that connects GO terms with edges between overlapping gene sets. 
This makes it easier to identify functional modules.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">emapplot</span><span class="p">(</span><span class="n">ora_analysis_bp</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"qvalue"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Count"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../img/07-emaplot.png" width="800px" /></p>

<p>On this plot, we can see that one major module related to cell death, the immune response etc. is to be seen along with two minor modules 
related to metabolism (upper left) and one related to jasmonic acid and wounding (bottom).</p>

<blockquote class="callout">
  <h2 id="important-note-1">Important note</h2>
  <p>Remember to perform the analysis for all GO categories: Biological Process (<code class="highlighter-rouge">ont = "BP"</code>), Cellular Component (<code class="highlighter-rouge">ont = "CC"</code>) and Molecular Function (<code class="highlighter-rouge">ont = "MF"</code>).</p>
</blockquote>

<h2 id="33-kegg-ora">3.3 KEGG ORA</h2>

<p><strong>KEGG</strong> stands for the ‚ÄúKyoto Encyclopedia of Genes and Genomes‚Äù. From the <a href="https://www.genome.jp/kegg/">KEGG website home page</a>:</p>
<blockquote>
  <p>KEGG is a database resource for understanding high-level functions and utilities of the biological system, such as the cell, the organism and the ecosystem, from molecular-level information, especially large-scale molecular datasets generated by genome sequencing and other high-throughput experimental technologies.</p>
</blockquote>

<p>Instead of using the Gene Ontology gene classification, one might be interested to use KEGG classification to view the
transcriptomic response of an organism. KEGG is not restricted to metabolic functions but has a great deal of metabolic maps that can help you.</p>

<p>To see if your organism is referenced in the KEGG database, you can search this page: https://www.genome.jp/kegg/catalog/org_list.html
In our case, <em>Arabidopsis thaliana</em> is referenced as ‚Äúath‚Äù in the KEGG database.</p>

<p>You can also do this programmatically using R and the <code class="highlighter-rouge">clusterProfiler</code> package.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">search_kegg_organism</span><span class="p">(</span><span class="s1">'ath'</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s1">'kegg_code'</span><span class="p">)</span><span class="w">
</span><span class="n">search_kegg_organism</span><span class="p">(</span><span class="s1">'Arabidopsis thaliana'</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s1">'scientific_name'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ora_analysis_kegg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">enrichKEGG</span><span class="p">(</span><span class="n">gene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff_arabidopsis_genes_annotated</span><span class="o">$</span><span class="n">entrezgene_id</span><span class="p">,</span><span class="w">
                                </span><span class="n">universe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_arabidopsis_genes_annotated</span><span class="o">$</span><span class="n">entrezgene_id</span><span class="p">,</span><span class="w">
                                </span><span class="n">organism</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ath"</span><span class="p">,</span><span class="w">
                                </span><span class="n">keyType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ncbi-geneid"</span><span class="p">,</span><span class="w">
                                </span><span class="n">minGSSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w">
                                </span><span class="n">maxGSSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w">
                                </span><span class="n">pAdjustMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BH"</span><span class="p">,</span><span class="w">
                                </span><span class="n">qvalueCutoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w">
                                </span><span class="n">use_internal_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="c1"># force to query latest KEGG db</span><span class="w">
                          

</span><span class="c1"># create a simple dotplot graph</span><span class="w">
</span><span class="n">dotplot</span><span class="p">(</span><span class="n">ora_analysis_kegg</span><span class="p">,</span><span class="w"> 
    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"qvalue"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">showCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> 
    </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Count"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../img/07-dotplot-kegg.png" width="800px" /></p>

<h2 id="34-kegg-modules-ora">3.4 KEGG Modules ORA</h2>

<p><a href="https://www.genome.jp/kegg/module.html">The KEGG MODULE datase</a> is more dedicated to metabolism and can help you to make sense of transcriptomic data using metabolic maps and modules.</p>

<p>The complete list of available modules is <a href="https://www.genome.jp/kegg-bin/get_htext">available here</a>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ora_analysis_kegg_modules</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">enrichMKEGG</span><span class="p">(</span><span class="n">gene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff_arabidopsis_genes_annotated</span><span class="o">$</span><span class="n">entrezgene_id</span><span class="p">,</span><span class="w">
                                         </span><span class="n">universe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_arabidopsis_genes_annotated</span><span class="o">$</span><span class="n">entrezgene_id</span><span class="p">,</span><span class="w">
                                         </span><span class="n">organism</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ath"</span><span class="p">,</span><span class="w">
                                         </span><span class="n">keyType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ncbi-geneid"</span><span class="p">,</span><span class="w">
                                         </span><span class="n">minGSSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w">           </span><span class="c1"># minimal size of genes annotated by Ontology term for testing.</span><span class="w">
                                         </span><span class="n">maxGSSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w">          </span><span class="c1"># maximal size of genes annotated for testing</span><span class="w">
                                         </span><span class="n">pAdjustMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BH"</span><span class="p">,</span><span class="w">
                                         </span><span class="n">qvalueCutoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">


</span><span class="c1"># create a simple dotplot graph</span><span class="w">
</span><span class="n">dotplot</span><span class="p">(</span><span class="n">ora_analysis_kegg_modules</span><span class="p">,</span><span class="w"> 
    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"qvalue"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">showCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> 
    </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Count"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../img/07-dotplot-kegg-modules.png" width="800px" /></p>

<blockquote class="discussion">
  <h2 id="discussion">Discussion</h2>
  <p>Compare the two KEGG plots. Can you identify differences? Which metabolic functions have been grouped together?</p>
</blockquote>

<h1 id="4gene-ontology-over-representation-analysis-with-agrigo-webtool">4.Gene Ontology Over Representation Analysis with AgriGO (webtool)</h1>

<p>AgriGO v2.0 is a webtool <a href="http://systemsbiology.cau.edu.cn/agriGOv2/index.php">accessible here</a> to perform gene ontology analyses. Two papers describe it extensively (see <a href="#82-references">8.2. References</a>).</p>

<p>From the AgriGO v2.0 home page:</p>
<blockquote>
  <p>AgriGO v2.0 is a web-based tool and database for gene ontology analyses. It specifically focuses on agricultural species and is user-friendly. AgriGO v2.0 is designed to provide deep support to the agricultural community in the realm of ontology analyses.</p>
</blockquote>

<p>You can find an <a href="http://systemsbiology.cau.edu.cn/agriGOv2/manual.php">extensive manual available here</a> to guide you through the main steps.</p>

<blockquote class="callout">
  <h2 id="important-note-2">Important note</h2>
  <p>There are two versions of AgriGO currently online, versions 1.x and version 2.0. Make sure you go to the <a href="http://systemsbiology.cau.edu.cn/agriGOv2/index.php">latest 2.0 version url</a>.</p>
</blockquote>

<h2 id="41-single-enrichment-analysis">4.1 Single Enrichment Analysis</h2>

<p><strong>We can perform a Single Enrichment Analysis (SEA) which is essentially similar to an ORA.</strong> AgriGO supports species-specific analyses. <br />
For <em>Arabidopsis thaliana</em> <a href="http://systemsbiology.cau.edu.cn/agriGOv2/specises_analysis.php?SpeciseID=1&amp;latin=Arabidopsis_thaliana">navigate here</a>.</p>

<p>First, write gene identifiers to a text file from which you can copy-paste the identifiers. Here, we use the complete list of the 4979 genes
differentially regulated (DC3000 versus Mock) but you can filter it on some criteria (e.g. fold change). This is what I‚Äôve done to gather less genes and speed up the SEA analysis.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">diff_genes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">log2FoldChange</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">with</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="n">quantile</span><span class="p">(</span><span class="n">log2FoldChange</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.75</span><span class="p">,</span><span class="m">0.9</span><span class="p">)))</span><span class="w">

</span><span class="n">diff_genes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">log2FoldChange</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">log2FoldChange</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.75</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># keeping fold changes above the 75th percentile</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="n">genes</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">write.table</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"diff_genes_for_agrigo.tsv"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Open this list using a text editor and copy-paste it into the ‚Äúinput a gene list‚Äù box.</p>

<p><img src="../img/07-agrigo-1.png" alt="input gene list for arabidopsis" height="400px" /></p>

<p>You will then have to choose a background (your ‚Äúuniverse‚Äù) to perform the SEA/ORA analysis. For <em>Arabidopsis thaliana</em>, you can choose the suggested background (TAIR10).</p>

<p><img src="../img/07-agrigo-2.png" alt="choice of the background and statistical test" height="400px" /></p>

<p>I suggest to use the hypergeometric distribution and the Yekutieli False Discovery Rate correction. The significance threshold and the minimum number of entries can be changed depending on the size of your input gene list.</p>

<p>If you have a long list, you might write your email address to collect your results later (analysis might take a while). You will arrive on a result page from which you can generate graphs, barplots, tables etc.</p>

<p><img src="../img/07-agrigo-3.png" alt="results of SEA analysis" height="50%" /></p>

<p>This DAG view gives a comprehensive overview of the GO terms and their relationships.</p>

<h2 id="42-parametric-analysis-of-gene-set-enrichment">4.2 Parametric Analysis of Gene Set Enrichment</h2>
<p>This analysis takes expression values also into account and could be an richer alternative to SEA.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">diff_genes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">log2FoldChange</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">log2FoldChange</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.75</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="n">genes</span><span class="p">,</span><span class="w"> </span><span class="n">log2FoldChange</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">write.table</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"diff_genes_for_agrigo_page.tsv"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\t"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../img/07-agrigo-4.png" alt="results of PAGE analysis" height="50%" /></p>

<h2 id="33-metascape-webtool">3.3 Metascape (webtool)</h2>
<p>Left to the reader. The basic usage is to copy-paste a list of gene identifiers (preferably Entrez id) inside the box.
Visit the <a href="https://metascape.org/gp/index.html#/main/step1">Metascape website here</a>.</p>

<blockquote class="callout">
  <h2 id="important-note-3">Important note</h2>
  <p>Metascape is restricted to 3000 genes so you will have to split our big list first into chuncks less &lt; 3000 genes.</p>
  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pos_diff_genes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff_genes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">log2FoldChange</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> 
</span></code></pre></div>  </div>
  <p>Then write the <code class="highlighter-rouge">pos_diff_genes</code> to a text file and copy-paste the list of genes.</p>
</blockquote>

<h2 id="34-gene-set-enrichment-analysis-gsea">3.4 Gene Set Enrichment Analysis (GSEA)</h2>

<p>The Gene Set Enrichment Analysis (GSEA) is another way to investigate functional enrichment of genes and pathways using the Gene Ontology classification. 
Please refer to <a href="https://yulab-smu.github.io/clusterProfiler-book/chapter2.html">the following section</a> in Prof. Guangchuang Yu book for a clear explanation of GSEA and how to implement it with <code class="highlighter-rouge">clusterProfiler</code>.</p>

<p><br /></p>

<h1 id="5-gene-set-enrichment-analysis-gsea-with-clusterprofiler">5. Gene Set Enrichment Analysis (GSEA) with ClusterProfiler</h1>

<p>Under construction.</p>

<h1 id="6-troubleshooting">6. Troubleshooting</h1>

<p>If biomart refuses to query Ensembl again, run this command:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">biomaRt</span><span class="o">::</span><span class="n">biomartCacheClear</span><span class="p">()</span><span class="w"> </span><span class="c1"># to solve a known bug https://github.com/BioinformaticsFMRP/TCGAbiolinks/issues/335</span><span class="w">
</span></code></pre></div></div>

<p>This will clean the cache memory and allow to perform the Ensembl query again.</p>

<h1 id="7-going-further">7. Going further</h1>

<h2 id="61-useful-links">6.1 Useful links</h2>
<ul>
  <li><a href="https://docs.ropensci.org/biomartr/">BiomartR</a></li>
  <li><a href="https://www.arabidopsis.org/portals/expression/microarray/microarrayExpressionV2.jsp">Arabidopsis.org (TAIR) list of data mining tools</a></li>
  <li><a href="https://www.researchgate.net/post/How_can_I_analyze_a_set_of_DEGs_differentially_expressed_genes_to_obtain_information_from_them">ResearchGate related question</a></li>
</ul>

<h2 id="62-references">6.2. References</h2>
<ul>
  <li><a href="https://yulab-smu.github.io/clusterProfiler-book/chapter2.html">The Cluster Profiler companion book, a great place to start</a></li>
  <li>Zhou et al. (2019). Metascape provides a biologist-oriented resource for the analysis of systems-level datasets. Nat Commun 10, 1523 (2019). <a href="https://doi.org/10.1038/s41467-019-09234-6">link</a></li>
  <li>Yates et al. (2020) Ensembl 2020, Nucleic Acids Research, Volume 48, Issue D1, 08 January 2020, Pages D682‚ÄìD688, <a href="https://doi.org/10.1093/nar/gkz966">Link</a></li>
  <li>Tian et al. (2017) agriGO v2.0: a GO analysis toolkit for the agricultural community. <em>Nucleic Acids Research</em>, Volume 45, Issue W1, Pages W122‚ÄìW129.<a href="https://doi.org/10.1093/nar/gkx382">Link</a></li>
  <li>Drost et al. (2017) Biomartr: genomic data retrieval with R. <em>Bioinformatics</em> 33(8): 1216-1217. <a href="https://academic.oup.com/bioinformatics/article/33/8/1216/2931816">doi:10.1093/bioinformatics/btw821</a>.</li>
</ul>

:ET